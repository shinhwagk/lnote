(()=>{"use strict";const e="->",n=(e,n)=>e.filter((e=>-1!==n.indexOf(e)));function t(e=1){const n=document.createElement("span");for(let t=0;t<e;t++)n.innerHTML+="&nbsp;";return n}function a(e,n){e.replaceChildren();const a=e;a.className="grid-note";const d=document.createElement("div");d.className="grid-note-id";const o=n.doc?"fa-file-word":"fa-ellipsis-h",c=n.files?"fa-folder":"fa-ellipsis-h",l=document.createElement("span");l.title=`id: ${n.id}, create date: ${n.cts}, modify date: ${n.mts}`,l.appendChild(t(2)),d.appendChild(s(o,"show doc",(()=>vscode.postMessage({command:"note-doc-show",params:{nb:n.nb,nId:n.id}})))),d.appendChild(l),d.appendChild(s(c,"show files",(()=>vscode.postMessage({command:"note-files-open",params:{nb:n.nb,nId:n.id}}))));const i=document.createElement("div");i.className="grid-note-contents",i.style.gridTemplateColumns=`repeat(${n.contents.length}, 1fr)`,n.contents.forEach((e=>{const n=document.createElement("div");n.className="grid-note-content",n.textContent=e,i.appendChild(n)}));const m=document.createElement("div");m.className="grid-note-edit",m.appendChild(s("fa-pen","edit note",(()=>vscode.postMessage({command:"note-edit",params:{nb:n.nb,nId:n.id}})))),m.appendChild(t());const r=s("fa-right-long","extend",(()=>{var e;null===(e=document.getElementById(`note-edit-extend-${n.id}`))||void 0===e||e.remove(),n.doc||(m.appendChild(t()),m.appendChild(s("fa-file-circle-plus","create doc",(()=>vscode.postMessage({command:"note-doc-create",params:{nb:n.nb,nId:n.id}}))))),n.files||(m.appendChild(t()),m.appendChild(s("fa-folder-plus","create files",(()=>vscode.postMessage({command:"note-files-create",params:{nb:n.nb,nId:n.id}}))))),m.appendChild(t()),m.appendChild(s("fa-xmark","create files",(()=>vscode.postMessage({command:"note-remove",params:{nb:n.nb,id:n.id}}))))}));r.id=`note-edit-extend-${n.id}`,m.appendChild(r),a.appendChild(d),a.appendChild(i),a.appendChild(m)}function s(e,n,t=null){const a=document.createElement("i");return a.className=`fas ${e} fa-sm`,a.onclick=t,a.title=n,a}function d(d,o){let c=function(n){const t={};let a="";for(const a of n){const[n,s]=a.split(e);n in t?t[n].push(s):t[n]=[s]}for(const[e,n]of Object.entries(t))a+=`${e} -> `,a+=n.sort().join(","),a+="; ";return a}(o);const l=h.notes.filter((e=>n(e.als,o).length===o.length)),i=document.createElement("div");i.className="grid-category";const m=document.createElement("div");m.textContent=c,m.className="grid-category-name",m.appendChild(t()),m.appendChild(s("fa-plus","create note",(()=>vscode.postMessage({command:"common-notes-note-add",params:{als:o}})))),m.appendChild(t()),m.appendChild(s("fa-pen","edit labels",(()=>vscode.postMessage({command:"common-notes-labels-edit",params:{als:o}}))));const r=document.createElement("div");r.className="grid-category-body";for(const e of l){const n=document.createElement("div");n.id=`note-${e.id}`,r.appendChild(n),a(n,e),i.append(m,r),d.append(i,document.createElement("p"))}}function o(){let e=document.getElementById("notes-categories");e.replaceChildren();const t=new Set;0===h.checkedLabels.size?h.notes.map((e=>e.als.sort().join("|||"))).forEach((e=>t.add(e))):h.notes.filter((e=>n(e.als,Array.from(h.checkedLabels)).length===h.checkedLabels.size)).map((e=>e.als.sort().join("|||"))).forEach((e=>t.add(e)));for(const n of t.values())d(e,n.split("|||"))}function c(){const a=document.getElementById("notes-labels");a.className="group-labels",a.replaceChildren();const s=new Set,d=[];for(const e of h.notes)h.checkedLabels.size>=1?n(e.als,Array.from(h.checkedLabels)).length===h.checkedLabels.size&&(e.als.forEach((e=>s.add(e))),d.push(e.als)):(h.allArrayLabels.forEach((e=>s.add(e))),d.push(e.als));const l=d.length>=1?d.reduce(((e,n)=>e.filter((e=>n.includes(e))))):[];for(const[n,d]of h.allGroupLabels.entries()){const i=document.createElement("div"),m=document.createElement("label");m.textContent=n,i.append(m,t());for(const n of Array.from(d).sort()){const a=document.createElement("label");h.checkedLabels.size>=1?h.checkedLabels.has(n)?a.className="pinCheckedLabel":s.has(n)?l.includes(n)?a.className="checkedLabel":a.className="unCheckedLabel":a.className="unAvailableLabel":s.has(n)?l.includes(n)?a.className="forceCheckedLabel":a.className="unCheckedLabel":a.className="unAvailableLabel",a.textContent=n.split(e)[1],a.onclick=()=>{"unCheckedLabel"===a.className?h.checkedLabels.add(n):("pinCheckedLabel".includes(a.className),h.checkedLabels.delete(n)),c(),o()},i.append(a,t())}a.append(i)}a.append(document.createElement("p"))}let l="domain";class i{constructor(){this.notes=[],this.s_s=0,this.checkedLabels=new Set,this.allArrayLabels=new Set,this.allGroupLabels=new Map,this.dals=[],this.dn=[],this.nb=""}}function m(){var e;h.s_s=(new Date).getTime();const n=null===(e=document.getElementById("APjFqb"))||void 0===e?void 0:e.value;if(n){const e=n.trim().split(/\s+/);e.length>=1&&vscode.postMessage({command:"get-search",params:{keywords:e}})}}function r(){const e=document.getElementById("root");null==e||e.replaceChildren();const n=document.createElement("div");n.className="search";const t=document.createElement("textarea");t.id="APjFqb",t.className="searchTextArea",t.maxLength=2048,t.rows=1;const a=document.createElement("button");a.className="searchButton",a.onclick=m,a.textContent="search";const s=document.createElement("span");s.id="search-time",n.append(t,a,s);const d=document.createElement("div");d.id="domain";const o=document.createElement("div");o.id="notes-labels";const c=document.createElement("div");c.id="notes-categories";const i="domain"===l?[d,o,c]:[n,o,c];null==e||e.append(...i)}function p(){var n;h.allArrayLabels.clear(),h.allGroupLabels.clear();for(const t of h.notes){t.als.forEach((e=>h.allArrayLabels.add(e)));for(const a of t.als){const[t]=a.split(e);h.allGroupLabels.has(t)?null===(n=h.allGroupLabels.get(t))||void 0===n||n.add(a):h.allGroupLabels.set(t,new Set([a]))}}}window.addEventListener("message",(e=>{const n=e.data;switch(n.command){case"kind":n.data.wk!==l&&(console.log("now",n.data.wk),l=n.data.wk,r(),h=new i),"domain"===l&&(h.nb=h.dn[0],h.dals=n.data.dals,vscode.postMessage({command:"get-domain"}));break;case"post-search":const e=(new Date).getTime();h.notes=n.data.notes,document.getElementById("search-time").textContent=e-h.s_s+" ms",p(),c(),o();break;case"post-domain":h.dn=n.data.dn,h.notes=n.data.notes,p(),function(){const e=document.getElementById("domain");null==e||e.replaceChildren();const n=document.createElement("h2"),a=document.createElement("span"),d=document.createElement("input");d.type="text",d.style.display="none",d.focus(),d.onkeydown=()=>{},a.textContent=`${h.dn.join(" / ")}`,n.appendChild(a),n.appendChild(t());const o=h.dn.map((e=>`domain->${e}`)).concat(`##nb->${h.dn[0]}`);n.appendChild(s("fa-plus","create note",(()=>vscode.postMessage({command:"common-notes-note-add",params:{als:o}})))),n.appendChild(t()),n.appendChild(s("fa-pen","edit labes",(()=>vscode.postMessage({command:"domain-labels-edit",params:{dn:h.dn}})))),n.appendChild(t()),null==e||e.append(n)}(),c(),o();break;default:document.body.innerHTML="<h1>loading...{message}</h1>"}})),console.log("lnotes webview open."),r();let h=new i;vscode.postMessage({command:"get-kind"})})();